<!DOCTYPE html>
<html lang="es-ES">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego - Proyecto final</title>
    <link rel="stylesheet" href="https://necolas.github.io/normalize.css/8.0.1/normalize.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <script defer src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="assets/style.css"/>
    <link rel="stylesheet" href="styles.css">

    <style>
        #particles-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
    </style>
</head>

<div class="top-bar"></div>

<body class="Cuerpo">

<canvas id="particles-bg"></canvas>

<header>
  <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
    <div class="container">
      <a class="navbar-brand" href="index.html">
        <img src="imagenes/UAO-LOGO-NUEVO_Mesa-de-trabajo-1-1-1-1.png" alt="El logo" height="45" class="img-fluid">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navGame" aria-controls="navGame" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navGame">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="index.html">Inicio</a></li>
          <li class="nav-item"><a class="nav-link" href="calendario.html">Actividades</a></li>
          <li class="nav-item"><a class="nav-link" href="video.html">Técnicas</a></li>
        </ul>
      </div>
    </div>
  </nav>
</header>

<main class="container text-center py-4">
  <h1 class="mb-4">Mini-juego: Tetris (descanso breve)</h1>
  <div class="mb-3">
    <div class="d-flex justify-content-center gap-2">
      <button id="start-btn" class="btn btn-success">Iniciar</button>
      <button id="pause-btn" class="btn btn-warning">Pausa</button>
      <button id="reset-btn" class="btn btn-outline-secondary">Reiniciar</button>
    </div>
  </div>

  <div class="d-flex justify-content-center">
    <div id="game-container" style="max-width:420px; width:100%; max-height: calc(100vh - 220px);">
      <canvas id="game" class="img-fluid border" style="width:100%; height:100%; display:block;" tabindex="0"></canvas>
    </div>
  </div>
  <p class="text-muted small mt-3">Controles: flechas izquierda/derecha para mover, flecha arriba para rotar.</p>
</main>

<script src="tetris.js"></script>

<!-- ========================================= -->
<!--   SISTEMA COMPLETO DE PARTÍCULAS + LÍNEAS -->
<!-- ========================================= -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  if (window.TetrisGame && typeof TetrisGame.init === 'function') {
    TetrisGame.init('game');
    document.getElementById('start-btn').addEventListener('click', () => TetrisGame.start());
    document.getElementById('pause-btn').addEventListener('click', () => TetrisGame.pause());
    document.getElementById('reset-btn').addEventListener('click', () => TetrisGame.reset());
  }

  const canvas = document.getElementById('particles-bg');
  const ctx = canvas.getContext('2d');
  let particlesArray = [];

  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener('resize', resize);

  class Particle {
    constructor() {
      this.x = Math.random() * canvas.width;
      this.y = Math.random() * canvas.height;
      this.size = Math.random() * 3 + 1;
      this.speedX = (Math.random() * 0.6) - 0.3;
      this.speedY = (Math.random() * 0.6) - 0.3;
      this.color = 'rgba(255, 0, 0, 0.8)';
    }
    update() {
      this.x += this.speedX;
      this.y += this.speedY;

      if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
      if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
    }
    draw() {
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  function initParticles() {
    particlesArray = [];
    for (let i = 0; i < 120; i++) {
      particlesArray.push(new Particle());
    }
  }

  function connectParticles() {
    for (let a = 0; a < particlesArray.length; a++) {
      for (let b = a + 1; b < particlesArray.length; b++) {
        let dx = particlesArray[a].x - particlesArray[b].x;
        let dy = particlesArray[a].y - particlesArray[b].y;
        let distance = Math.sqrt(dx * dx + dy * dy);

        if (distance < 120) {
          ctx.strokeStyle = 'rgba(255, 0, 0, 0.3)';
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.moveTo(particlesArray[a].x, particlesArray[a].y);
          ctx.lineTo(particlesArray[b].x, particlesArray[b].y);
          ctx.stroke();
        }
      }
    }
  }

  function animateParticles() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    particlesArray.forEach(p => {
      p.update();
      p.draw();
    });

    connectParticles();

    requestAnimationFrame(animateParticles);
  }

  initParticles();
  animateParticles();
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
